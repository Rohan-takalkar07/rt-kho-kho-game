<html>

<body
    style="font-family: Arial; background:transparent; padding:40px; display: flex; justify-content: center; align-items: center; -webkit-app-region: drag;">

    <div style="width:380px; padding:20px; background:white; 
            border:1px solid #c7c7c7; border-radius:8px; -webkit-app-region: no-drag;">

        <h2 style="margin:0 0 15px 0;">Add Defenders</h2>

        <!-- Batch 1 -->
        <div style="display:flex; justify-content:space-between;">
            <div id="defenderSection" style="margin-bottom: 20px;">
                <p style="margin:0 0 8px 0; font-size:14px; font-weight:bold;">
                    Select Defenders for Batch <span id="batchNumber">1</span>
                </p>

                <div id="playerGrid" style="display:grid; grid-template-columns: repeat(3, 60px); gap:10px;">
                    <div class="player-number" data-player="02"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        02</div>
                    <div class="player-number" data-player="03"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        03</div>
                    <div class="player-number" data-player="04"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        04</div>

                    <div class="player-number" data-player="06"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        06</div>
                    <div class="player-number" data-player="07"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        07</div>

                    <div class="player-number" data-player="08"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        08
                    </div>

                    <div class="player-number" data-player="10"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        10
                    </div>
                    <div class="player-number" data-player="11"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        11</div>

                    <div class="player-number" data-player="12"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        12
                    </div>
                </div>
            </div>

            <!-- Substitute -->
            <div id="substituteSection" style="padding: 10px; margin-left: 10px;">
                <p style="margin:0 0 8px 0; font-size:14px; font-weight:bold; ">
                    Select Substitute Players
                </p>

                <div style="display:grid; grid-template-columns: repeat(2, 60px); gap:10px;">
                    <div class="substitute-number" data-player="21"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        21</div>
                    <div class="substitute-number" data-player="18"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        18</div>

                    <div class="substitute-number" data-player="45"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        45</div>
                    <div class="substitute-number" data-player="63"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        63</div>
                    <div class="substitute-number" data-player="33"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        33</div>
                    <div class="substitute-number" data-player="99"
                        style="padding:12px; background:#e8edf7; text-align:center; border-radius:6px; cursor:pointer;">
                        99</div>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div style="margin-top:20px; text-align:right;">
            <button id="resetBtn" style="padding:8px 16px; border:1px solid #ccc; background:#f0f0f0;
                       border-radius:5px; margin-right:8px; cursor:pointer;">
                Reset
            </button>

            <button id="submitBtn" style="padding:8px 16px; border:none; background:#007bff;
                       color:white; border-radius:5px; cursor:pointer;">
                Submit
            </button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        let selectedPlayers = [];
        let currentBatch = 1;
        let assignedPlayers = [];

        // Get all player number divs (both defender and substitute)
        const playerDivs = document.querySelectorAll('.player-number');
        const substituteDivs = document.querySelectorAll('.substitute-number');

        // Listen for batch number
        ipcRenderer.on('set-batch', (event, batchNumber) => {
            currentBatch = batchNumber;
            const title = currentBatch === 'Substitute'
                ? 'Add Substitute Players'
                : `Add Defenders - Batch ${batchNumber}`;
            document.querySelector('h2').textContent = title;

            // Request assigned players from main window
            ipcRenderer.send('request-assigned-players');
        });

        // Receive assigned players and disable them
        ipcRenderer.on('assigned-players', (event, players) => {
            assignedPlayers = players;

            // Handle defender players
            playerDivs.forEach(div => {
                const playerNumber = div.getAttribute('data-player');
                if (assignedPlayers.includes(playerNumber)) {
                    // Mark as already assigned
                    div.style.background = '#cccccc';
                    div.style.color = '#666666';
                    div.style.cursor = 'not-allowed';
                    div.style.opacity = '0.5';
                    div.setAttribute('data-assigned', 'true');
                }
            });

            // Handle substitute players
            substituteDivs.forEach(div => {
                const playerNumber = div.getAttribute('data-player');
                if (assignedPlayers.includes(playerNumber)) {
                    // Mark as already assigned
                    div.style.background = '#cccccc';
                    div.style.color = '#666666';
                    div.style.cursor = 'not-allowed';
                    div.style.opacity = '0.5';
                    div.setAttribute('data-assigned', 'true');
                }
            });
        });

        // Add click event to each defender player number
        playerDivs.forEach(div => {
            div.addEventListener('click', function () {
                const playerNumber = this.getAttribute('data-player');

                // Check if already assigned to another batch
                if (this.getAttribute('data-assigned') === 'true') {
                    alert('This player is already assigned to another batch');
                    return;
                }

                // Check if already selected
                if (selectedPlayers.includes(playerNumber)) {
                    // Deselect
                    selectedPlayers = selectedPlayers.filter(p => p !== playerNumber);
                    // Reset to original style
                    this.style.background = '#e8edf7';
                    this.style.color = 'black';
                } else {
                    // Check if we can select more (max 3)
                    if (selectedPlayers.length < 3) {
                        selectedPlayers.push(playerNumber);
                        // Highlight selected
                        this.style.background = '#28a745';
                        this.style.color = 'white';
                    } else {
                        alert(`You can only select 3 players for Batch ${currentBatch}`);
                    }
                }
            });
        });

        // Add click event to each substitute player number
        substituteDivs.forEach(div => {
            div.addEventListener('click', function () {
                const playerNumber = this.getAttribute('data-player');

                // Check if already assigned
                if (this.getAttribute('data-assigned') === 'true') {
                    alert('This substitute player is already assigned');
                    return;
                }

                // Check if already selected
                if (selectedPlayers.includes(playerNumber)) {
                    // Deselect
                    selectedPlayers = selectedPlayers.filter(p => p !== playerNumber);
                    // Reset to original style
                    this.style.background = '#e8edf7';
                    this.style.color = 'black';
                } else {
                    // Check if we can select more (max 3)
                    if (selectedPlayers.length < 3) {
                        selectedPlayers.push(playerNumber);
                        // Highlight selected
                        this.style.background = '#28a745';
                        this.style.color = 'white';
                    } else {
                        alert('You can only select 3 substitute players');
                    }
                }
            });
        });

        // Reset button
        document.getElementById('resetBtn').addEventListener('click', function () {
            selectedPlayers = [];

            // Reset defender players
            playerDivs.forEach(div => {
                // Only reset if not assigned to another batch
                if (div.getAttribute('data-assigned') !== 'true') {
                    div.style.background = '#e8edf7';
                    div.style.color = 'black';
                }
            });

            // Reset substitute players
            substituteDivs.forEach(div => {
                // Only reset if not assigned
                if (div.getAttribute('data-assigned') !== 'true') {
                    div.style.background = '#e8edf7';
                    div.style.color = 'black';
                }
            });
        });

        // Submit button
        document.getElementById('submitBtn').addEventListener('click', function () {
            if (selectedPlayers.length === 3) {
                // Send selected players to main window with batch number or substitute
                const eventName = currentBatch === 'Substitute'
                    ? 'players-selected-substitute'
                    : `players-selected-batch${currentBatch}`;
                ipcRenderer.send(eventName, selectedPlayers);
                window.close();
            } else {
                const batchName = currentBatch === 'Substitute' ? 'Substitutes' : `Batch ${currentBatch}`;
                alert(`Please select exactly 3 players for ${batchName}`);
            }
        });
    </script>

</body>

</html>