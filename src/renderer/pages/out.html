<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Add Wicket Details</title>
</head>

<body style="font-family: Arial, sans-serif; background-color: #f5f5f5; padding: 20px;">
    <div
        style="max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);">
        <h2 style="text-align:center; margin-bottom:20px; ">Add Wicket Details</h2>

        <div style="display: flex; justify-content: space-between   ;">


            <div style="width: 60%; margin-right: 20px; border:2px solid black; padding: 20px;">
                <!-- Last Out Defender -->
                <div style="margin-bottom:15px;">
                    <div style="font-weight:bold; margin-left: 10px;">Last Out Defender:</div>
                    <div id="last-out-player"
                        style=" border: 1px solid black; border-radius:100%; width: 35%; height: 35px; margin-top: 10px; text-align: center; padding-top: 10px; margin-left: 45px; margin-bottom: 7px; padding-top: 15px;">
                        -</div>
                    <div id="last-out-time" style="margin-left:57px; ">00:00</div>
                </div>

                <!-- Turn Timer -->
                <div style="margin-bottom:15px; margin-top:30px;">
                    <span style="font-weight:bold; margin-left: 30px;;">Turn Timer</span>
                    <div id="turn-timer-display"
                        style="margin-top: 10px; border: 2px solid black; text-align: center; padding: 20px; font-size: 20px; font-weight: bold; background-color: rgba(143, 141, 142, 0.729);">
                        00:00</div>
                </div>

                <!-- Select Next Defender -->
                <div style="margin-top: 40px;">
                    <div style="font-weight: bold;">Select Next Defender</div>

                    <div id="next-defender-container"
                        style="display: flex; justify-content: space-evenly; width: 80%; align-items: center;">
                        <!-- Generated dynamically -->
                    </div>
                </div>

            </div>


            <div>
                <!-- Select Wicket Type -->
                <div style="margin-bottom:20px;">
                    <span style="font-weight:bold;">Select Wicket Type:</span>
                    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;" id="wicket-types">
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            S</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            SA</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            D</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            T</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            P</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            O</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            L</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            R</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            W</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            Y</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            ||</div>
                        <div class="box"
                            style="width:80px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            F</div>
                    </div>
                </div>

            </div>



            <div>

                <!-- Select Attacker -->
                <div style="margin-bottom:20px;">
                    <span style="font-weight:bold;">Select Attacker:</span>
                    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;" id="attackers">
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            02</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            03</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            04</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            06</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            07</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            09</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            10</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            11</div>
                        <div class="attacker"
                            style="width:60px; height:40px; background-color:#e0e0e0; border-radius:5px; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                            14</div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Action Buttons -->
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:30px;">
            <button id="btn-cancel"
                style="padding:10px 20px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; background-color:#ccc;">Cancel</button>
            <button id="btn-confirm"
                style="padding:10px 20px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; background-color:#4CAF50; color:white;">Confirm</button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let receivedData = null;
        let selectedNextDefenderIndex = null;
        let selectedBatchNum = null;
        let selectedWicketType = null;
        let selectedAttacker = null;

        ipcRenderer.on('init-out-data', (event, data) => {
            console.log("Received Data:", data);
            receivedData = data;

            // 1. Populate Last Out Defender
            document.getElementById('last-out-player').textContent = data.outPlayerName;
            document.getElementById('last-out-time').textContent = data.outPlayerTime;

            // Populate Turn Timer with same time
            document.getElementById('turn-timer-display').textContent = data.outPlayerTime;

            // 2. Populate Next Defenders OR Next Batch
            const container = document.getElementById('next-defender-container');
            container.innerHTML = ''; // Clear existing

            if (data.allOut) {
                // Show Batch Options
                [1, 2, 3].forEach(batchNum => {
                    let div = document.createElement('div');
                    div.textContent = "Batch " + batchNum;

                    if (data.currentBatchNum && data.currentBatchNum === batchNum) {
                        // Disabled style for current batch
                        div.style = "border: 1px solid #999; width: 80px; height: 33px; margin-top: 10px; text-align: center; padding-top: 17px; margin-left: 10px; margin-bottom: 10px; font-weight: bold; background-color: #ddd; color: #777; border-radius: 5px; cursor: not-allowed;";
                    } else {
                        // Active style
                        div.style = "border: 1px solid black; width: 80px; height: 33px; margin-top: 10px; text-align: center; padding-top: 17px; margin-left: 10px; margin-bottom: 10px; font-weight: bold; cursor: pointer; background-color: white; border-radius: 5px;";

                        div.onclick = () => {
                            Array.from(container.children).forEach(c => {
                                // Only reset background if it's not the disabled one
                                if (c.style.cursor !== 'not-allowed') {
                                    c.style.backgroundColor = 'white';
                                }
                            });
                            div.style.backgroundColor = 'lightgreen';
                            selectedBatchNum = batchNum;
                            selectedNextDefenderIndex = null;
                        };
                    }
                    container.appendChild(div);
                });

            } else {
                // Show Remaining Players
                data.allDefenders.forEach((player, index) => {
                    if (index === data.outPlayerIndex || (data.isPlayerOut && data.isPlayerOut[index])) return;

                    let div = document.createElement('div');
                    div.textContent = player;
                    div.style = "border: 1px solid black; border-radius:100%; width: 50px; height: 33px; margin-top: 10px; text-align: center; padding-top: 17px; margin-left: 10px; margin-bottom: 10px; font-weight: bold; cursor: pointer; background-color: white;";

                    div.onclick = () => {
                        Array.from(container.children).forEach(c => c.style.backgroundColor = 'white');
                        div.style.backgroundColor = 'lightgreen';
                        selectedNextDefenderIndex = index;
                        selectedBatchNum = null;
                    };

                    container.appendChild(div);
                });
            }
        });

        // Wicket Type Selection
        const wicketBoxes = document.querySelectorAll('#wicket-types .box');
        wicketBoxes.forEach(box => {
            box.addEventListener('click', () => {
                // Deselect others
                wicketBoxes.forEach(b => {
                    b.style.backgroundColor = "#e0e0e0";
                    b.style.color = "black";
                });
                // Select this one
                box.style.backgroundColor = "black";
                box.style.color = "white";
                selectedWicketType = box.textContent.trim();
            });
            // Hover effects
            box.addEventListener('mouseover', () => {
                if (box.style.backgroundColor !== "black") box.style.backgroundColor = "#c0c0c0";
            });
            box.addEventListener('mouseout', () => {
                if (box.style.backgroundColor !== "black") box.style.backgroundColor = "#e0e0e0";
            });
        });

        // Attacker Selection
        const attackerBoxes = document.querySelectorAll('.attacker');
        attackerBoxes.forEach(box => {
            box.addEventListener('click', () => {
                // Deselect others
                attackerBoxes.forEach(b => {
                    b.style.backgroundColor = "#e0e0e0";
                    b.style.color = "black";
                });
                // Select this one
                box.style.backgroundColor = "black";
                box.style.color = "white";
                selectedAttacker = box.textContent.trim();
            });
            // Hover effects
            box.addEventListener('mouseover', () => {
                if (box.style.backgroundColor !== "black") box.style.backgroundColor = "#c0c0c0";
            });
            box.addEventListener('mouseout', () => {
                if (box.style.backgroundColor !== "black") box.style.backgroundColor = "#e0e0e0";
            });
        });

        // Buttons
        document.getElementById('btn-cancel').onclick = () => {
            ipcRenderer.send('close-out-window');
        };

        document.getElementById('btn-confirm').onclick = () => {
            if (selectedNextDefenderIndex !== null) {
                ipcRenderer.send('out-complete', selectedNextDefenderIndex);
            } else if (selectedBatchNum !== null) {
                // Send batch selection
                ipcRenderer.send('batch-selected', selectedBatchNum);
            } else {
                alert("Please select the next defender or batch.");
            }
        };

    </script>